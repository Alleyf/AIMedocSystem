{% load cache %}
{% load static %}
{#{% load compress %}#}
{% cache None 'head_graph' %}
    <!DOCTYPE html>
    <html style="height: 100%;width:100%" lang="en">
    <head>
        <meta charset="UTF-8">
        <title>åŒ»å­¦çŸ¥è¯†å›¾è°±</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="icon" href="{% static '/images/logo.png' %}" type="image/x-icon"/>
        <link rel="shortcut icon" href="{% static '/images/logo.png' %}" type="image/x-icon"/>
        <link href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.3.0/css/all.min.css" rel="stylesheet">
        {#        {% compress css %}#}
        <link rel="stylesheet" href="{% static 'plugins/bootstrap-5.2.3/css/bootstrap.min.css' %}">
        <style>
            /* Let's get this party started */
            ::-webkit-scrollbar {
                width: 7px;
            }

            /* Track */
            ::-webkit-scrollbar-track {
                -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.3);
                -webkit-border-radius: 10px;
                border-radius: 10px;
            }

            /* Handle */
            ::-webkit-scrollbar-thumb {
                -webkit-border-radius: 10px;
                border-radius: 10px;
                background: rgb(205, 206, 224);
                -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.5);
            }

            ::-webkit-scrollbar-thumb:window-inactive {
                background: rgb(255, 255, 255);
            }

            html, body {
                margin: 0;
                padding: 0;
                width: 100%;
                height: 100%;
            {#background: url("{% static '/images/bg.jpg' %}") no-repeat 0 0 transparent;#}
            }

            .background {
                position: absolute;
                display: block;
                top: 0;
                left: 0;
                z-index: -10;
            }
        </style>
        {#        {% endcompress %}#}
    </head>
{% endcache %}
<body>
<div class="container-fluid clearfix" style="height: 100%;width: 100%">
    <canvas id="particles-js" class="background"></canvas>
    <nav class="navbar bg-body-tertiary" style="position: static!important;">
        <div class="container-fluid">
            <a class="navbar-brand">åŒ»å­¦çŸ¥è¯†å›¾è°±</a>
            <form class="d-flex" role="search" method="post" action="/chart/graph/">
                {% csrf_token %}
                <input class="form-control me-2" name="disease_node" type="text"
                       placeholder="Search for disease" style="padding-right: 50px ">
                <button class="btn btn-outline-success" type="submit" id="liveToastBtn"><i
                        class="fa-solid fa-magnifying-glass"></i></button>
            </form>
            <div class="d-flex">
                <i class="fas fa-expand-arrows-alt" onclick="fullScreen()"
                   style="margin-right: 10px;font-size: 25px;color: black"></i>
                <a href="../../doc/query">
                    <i class="fa-solid fa-magnifying-glass" style="font-size: 25px;color: black"></i>
                </a>
            </div>
            <div class="toast-container position-fixed bottom-0 end-0 p-3">
                <div id="liveToast" class="toast fade show text-bg-primary" role="alert" aria-live="assertive"
                     aria-atomic="true">
                    <div class="toast-header">
                        <img height="20px" width="20px" src="{% static '/images/logo.png' %}" class="rounded me-2"
                             alt="...">
                        <strong class="me-auto">æ™ºæ£€æ…§åŒ»</strong>
                        <small>{% now "Y-m-d G:i:s" %}</small>
                        <button type="button" id="closetoast" class="btn-close" data-bs-dismiss="toast"
                                aria-label="Close"></button>
                    </div>
                    <div class="toast-body">
                        {{ ctx }}
                    </div>
                </div>
            </div>
        </div>
    </nav>
    <div class="container-fluid" id="chart-panel" style="display: flex;height: 710px;width: 100%;overflow: auto;"></div>

</div>
{% cache None 'plugin' %}
    {#    {% compress js %}#}
    <script type="text/javascript" src="{% static 'js/echarts.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/jquery-3.6.1.min.js' %}"></script>
    {#    {% endcompress %}#}
    <script src="https://cdn.bootcdn.net/ajax/libs/Darkmode.js/1.5.7/darkmode-js.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/particlesjs/2.2.2/particles.min.js"></script>
    {#    {% compress js %}#}
    <script type="text/javascript">
        window.onload
            = function () {
            Particles.init
            ({
                selector:
                    '.background'
            });
        };
    </script>
    <script type="text/javascript">
        $(function () {
            {#listen_window_size();#}
            closetoast();
        })

        function closetoast() {
            $("#liveToast").click(function () {
                $("#liveToast").attr('class', 'toast fade hide')
                console.log('å…³é—­æç¤º')
            })
        }

        function listen_window_size() {
            function set_chart_panel() {
                let h = '710px'
                console.log(h)
                $(window).resize(
                    function () {
                        $("canvas").attr("style", "height:" + h);
                        $("canvas").closest('div').attr("style", "height:" + h);
                        console.log($("#chart-panel").attr("style", "height:" + h));
                    }
                )
            }

            window.onload = function () {
                set_chart_panel();
            }
            window.onresize = function () {
                set_chart_panel();
            }
        }


        function toggleFullScreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                }
            }
        }

        //å®ç°å…¨å±
        function fullScreen() {
            toggleFullScreen()
        }
    </script>
    {#    {% endcompress %}#}
{% endcache %}
{#{% compress js %}#}
<script type="text/javascript">
    var neo4j_data = [{{ neo4j_data|safe }}]
    var data1 = neo4j_data[0]['data']
    var links1 = neo4j_data[0]['links']
    {#console.log(typeof (data1))#}
    {#console.log(typeof (links1))#}
    let mapd = new Map();
    for (let item of data1) {
        if (!mapd.has(item.id)) {
            mapd.set(item.id, item);
        }
    }
    let objd = [...mapd.values()];
    let mapl = new Map();
    for (let item of links1) {
        if (!mapl.has(item.id)) {
            mapl.set(item.id, item);
        }
    }
    let objl = [...mapl.values()];
    links1 = objl;
    data1 = objd;
    {#console.log(data1, typeof (data1))#}
    {#console.log(links1, typeof (links1))#}
    var dom = document.getElementById("chart-panel");
    var myChart1 = echarts.init(dom);
    var categories1 = [{name: "Disease"}, {name: "Check"}, {name: "Department"}, {name: "Drug"}, {name: "Food"}, {name: "Producer"}, {name: "Symptom"}];
    var option;
    {#let namels = {#}
    {#    "Disease": "ç–¾ç—…",#}
    {#    "Check": "æ£€æŸ¥",#}
    {#    "Department": "ç§ç±»",#}
    {#    "Drug": "å®œç”¨è¯",#}
    {#    "Food": "å»ºè®®é£Ÿç‰©",#}
    {#    "Producer": "ç—…å› ",#}
    {#    "Symptom": "ç—‡çŠ¶"#}
    //}
    option = {
        // å›¾çš„æ ‡é¢˜
        title: {
            {#text: 'åŒ»å­¦çŸ¥è¯†å›¾è°±'#}
        },
        // æç¤ºæ¡†çš„é…ç½®
        tooltip: {
            formatter: function (x) {
                return x.data.des;
            }
        },
        // å·¥å…·ç®±
        toolbox: {
            // æ˜¾ç¤ºå·¥å…·ç®±
            show: true,
            feature: {
                mark: {
                    show: true
                },
                // è¿˜åŸ
                restore: {
                    show: true
                },
                // ä¿å­˜ä¸ºå›¾ç‰‡
                saveAsImage: {
                    show: true
                }
            }
        },
        legend: [{
            x: 'right',      //å¯è®¾å®šå›¾ä¾‹åœ¨å·¦ã€å³ã€å±…ä¸­
            y: 'center',     //å¯è®¾å®šå›¾ä¾‹åœ¨ä¸Šã€ä¸‹ã€å±…ä¸­
            itemGap: 50,//å›¾ä¾‹å›¾æ ‡ä¸æ–‡å­—é—´çš„é—´è·
            data: categories1.map(function (a) {
                {#console.log(namels[a.name])#}
                return a.name;
            }),
            textStyle: {
                //å›¾ä¾‹å­—ä½“å¤§å°
                fontSize: 18,
            },
            //å›¾ä¾‹å¤§å°
            itemHeight: 25,
            //å›¾ä¾‹æ»šåŠ¨æ˜¾ç¤º
            type: 'scroll',
            //å›¾ä¾‹çºµå‘æ˜¾ç¤º
            orient: 'vertical',
            //å›¾ä¾‹ä½ç½®
            {#right: 0,#}
            {#top: 30,#}
            {#bottom: 30,#}

        }],
        series: [{
            type: 'graph', // ç±»å‹:å…³ç³»å›¾
            layout: 'force', //å›¾çš„å¸ƒå±€ï¼Œç±»å‹ä¸ºåŠ›å¯¼å›¾
            symbolSize: 50, // è°ƒæ•´èŠ‚ç‚¹çš„å¤§å°
            roam: true, // æ˜¯å¦å¼€å¯é¼ æ ‡ç¼©æ”¾å’Œå¹³ç§»æ¼«æ¸¸ã€‚é»˜è®¤ä¸å¼€å¯ã€‚å¦‚æœåªæƒ³è¦å¼€å¯ç¼©æ”¾æˆ–è€…å¹³ç§»,å¯ä»¥è®¾ç½®æˆ 'scale' æˆ–è€… 'move'ã€‚è®¾ç½®æˆ true ä¸ºéƒ½å¼€å¯

            edgeSymbol: ['circle', 'arrow'],
            edgeSymbolSize: [4, 10],
            force: {
                repulsion: 1000,
                edgeLength: [10, 60],
                {#edgeLength: 10,#}
                {#gravity: 0.01,#}
                {#layoutAnimation: false  //åˆå§‹åŒ–æ—¶è½¬åŠ¨åŠ¨ç”»#}
            },
            draggable: true,
            lineStyle: {
                normal: {
                    width: 2,
                    color: '#5b65f1',
                }
            },
            edgeLabel: {
                normal: {
                    show: true,
                    formatter: function (x) {
                        return x.data.name;
                    },
                    textStyle: {
                        fontSize: 10
                    }
                }
            },
            label: {
                position: 'center',
                normal: {
                    show: true,
                    textStyle: {}
                }
            },
            // æ•°æ®
            data: data1,
            links: links1,
            categories: categories1,
            color: ['#c23531', '#2f4554', '#61a0a8', '#d48265', '#91c7ae', '#749f83', '#ca8622', '#bda29a', '#6e7074', '#546570', '#c4ccd3'],
        }]
    };
    {#console.log(option)#}
    {#if (option && typeof option === 'object') {#}
    myChart1.setOption(option);


</script>
{#{% endcompress %}#}
{% cache None 'themejs' %}
    {#    {% compress js %}#}
    <script type="text/javascript">

        $(function () {
            thememode();
        })

        function thememode() {
            const options = {
                bottom: 'unset', // default: '32px'
                right: 'unset', // default: '32px'
                left: '150px', // default: 'unset'
                time: '0.5s', // default: '0.3s'
                mixColor: '#fff', // default: '#fff'
                backgroundColor: '#fff', // default: '#fff'
                buttonColorDark: '#100f2c', // default: '#100f2c'
                buttonColorLight: '#fff', // default: '#fff'
                saveInCookies: true, // default: true,
                label: 'ğŸŒ“', // default: ''
                autoMatchOsTheme: true// default: true
            }

            function addDarkmodeWidget() {
                let darkmode = new Darkmode(options);
                darkmode.showWidget();

            }

            window.addEventListener('load', addDarkmodeWidget);
        }

    </script>
    {#    {% endcompress %}#}
{% endcache %}
</body>
</html>
