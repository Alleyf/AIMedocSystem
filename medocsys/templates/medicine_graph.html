{% load static %}
<!DOCTYPE html>
<html style="height: 100%;width:100%">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="{% static '/images/logo.png' %}" type="image/x-icon"/>
    <link rel="shortcut icon" href="{% static '/images/logo.png' %}" type="image/x-icon"/>
    <link href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.3.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'plugins/bootstrap-5.2.3/css/bootstrap.min.css' %}">
    <title>医学知识图谱</title>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
        {#background: url("{% static '/images/bg.jpg' %}") no-repeat 0 0 transparent;#}
        }

        .background {
            position: absolute;
            display: block;
            top: 0;
            left: 0;
            z-index: -10;
        }
    </style>
</head>
<body>
<div class="container-fluid clearfix" style="height: 100%;width: 100%">
    <canvas id="particles-js" class="background"></canvas>
    <div style="float: left">
        <h4>医学知识图谱</h4>
    </div>
    <div style="float: right">
        <i class="fas fa-expand-arrows-alt" onclick="fullScreen()"
           style="margin-right: 10px;font-size: 25px;color: black"></i>
        <a href="../../doc/query">
            <i class="fa-solid fa-magnifying-glass" style="font-size: 25px;color: black"></i>
        </a>
    </div>
    <div class="container-fluid" id="chart-panel" style="display: flex;height: 734px;width: 100%;overflow: auto;"></div>

</div>
<script type="text/javascript" src="{% static 'js/echarts.min.js' %}"></script>
<script type="text/javascript" src="{% static 'js/jquery-3.6.1.min.js' %}"></script>
{#<script src="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.3.0/js/fontawsome.min.js"></script>#}
<script src="https://cdnjs.cloudflare.com/ajax/libs/particlesjs/2.2.2/particles.min.js"></script>
<script type="text/javascript">
    window.onload
        = function () {
        Particles.init
        ({
            selector:
                '.background'
        });
    };
</script>
<script type="text/javascript">
    $(function () {
        listenKey();
        set_chart_panel();
    })

    function set_chart_panel() {
        h = $("#particles-js").attr("height")
        $("#chart-panel").attr("height", h)
    }

    <!--大屏-->
    function listenKey() {
        document.addEventListener("keydown", function (e) {
            if (e.keyCode === 13) {
                toggleFullScreen();
            }
        }, false);
    }

    function toggleFullScreen() {
        if (!document.fullscreenElement) {
            document.documentElement.requestFullscreen();
        } else {
            if (document.exitFullscreen) {
                document.exitFullscreen();
            }
        }
    }

    //实现全屏
    function fullScreen() {
        toggleFullScreen()
    }
</script>
<script type="text/javascript">
    var neo4j_data = [{{ neo4j_data|safe }}]
    var data1 = neo4j_data[0]['data']
    var links1 = neo4j_data[0]['links']
    {#console.log(typeof (data1))#}
    {#console.log(typeof (links1))#}
    let mapd = new Map();
    for (let item of data1) {
        if (!mapd.has(item.id)) {
            mapd.set(item.id, item);
        }
    }
    let objd = [...mapd.values()];
    let mapl = new Map();
    for (let item of links1) {
        if (!mapl.has(item.id)) {
            mapl.set(item.id, item);
        }
    }
    let objl = [...mapl.values()];
    links1 = objl;
    data1 = objd;
    {#console.log(data1, typeof (data1))#}
    {#console.log(links1, typeof (links1))#}
    var dom = document.getElementById("chart-panel");
    var myChart1 = echarts.init(dom);
    var categories1 = [{name: "Disease"}, {name: "Check"}, {name: "Department"}, {name: "Drug"}, {name: "Food"}, {name: "Producer"}, {name: "Symptom"}];
    var option;
    option = {
        // 图的标题
        title: {
            {#text: '医学知识图谱'#}
        },
        // 提示框的配置
        tooltip: {
            formatter: function (x) {
                return x.data.des;
            }
        },
        // 工具箱
        toolbox: {
            // 显示工具箱
            show: true,
            feature: {
                mark: {
                    show: true
                },
                // 还原
                restore: {
                    show: true
                },
                // 保存为图片
                saveAsImage: {
                    show: true
                }
            }
        },
        legend: [{
            data: categories1.map(function (a) {
                return a.name;
            }),
            textStyle: {
                //图例字体大小
                fontSize: 18,
            },
            //图例大小
            itemHeight: 25,
            //图例滚动显示
            type: 'scroll',
            //图例纵向显示
            {#orient: 'vertical',#}
            //图例位置
            {#right: 0,#}
            {#top: 30,#}
            {#bottom: 30,#}

        }],
        series: [{
            type: 'graph', // 类型:关系图
            layout: 'force', //图的布局，类型为力导图
            symbolSize: 50, // 调整节点的大小
            roam: true, // 是否开启鼠标缩放和平移漫游。默认不开启。如果只想要开启缩放或者平移,可以设置成 'scale' 或者 'move'。设置成 true 为都开启

            edgeSymbol: ['circle', 'arrow'],
            edgeSymbolSize: [4, 10],
            force: {
                repulsion: 1000,
                edgeLength: [10, 60],
                {#edgeLength: 10,#}
                {#gravity: 0.01,#}
                {#layoutAnimation: false  //初始化时转动动画#}
            },
            draggable: true,
            lineStyle: {
                normal: {
                    width: 2,
                    color: '#5b65f1',
                }
            },
            edgeLabel: {
                normal: {
                    show: true,
                    formatter: function (x) {
                        return x.data.name;
                    },
                    textStyle: {
                        fontSize: 10
                    }
                }
            },
            label: {
                position: 'center',
                normal: {
                    show: true,
                    textStyle: {}
                }
            },
            // 数据
            data: data1,
            links: links1,
            categories: categories1,
            color: ['#c23531', '#2f4554', '#61a0a8', '#d48265', '#91c7ae', '#749f83', '#ca8622', '#bda29a', '#6e7074', '#546570', '#c4ccd3'],


        }]
    };
    {#console.log(option)#}
    {#if (option && typeof option === 'object') {#}
    myChart1.setOption(option);


</script>
</body>
</html>
